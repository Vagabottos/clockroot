<ion-toolbar color="primary">
  <ion-title>
    <span id="Corvid">
      <span class="ion-hide-sm-down">{{
        "Factions.Cogwheel Corvids" | translate
      }}</span>
      <span class="ion-hide-md-up">{{
        "FactionsShort.Cogwheel Corvids" | translate
      }}</span>
    </span>
  </ion-title>

  <ion-buttons slot="end">
    <ion-button *ngIf="!bot.setupHidden" (click)="botService.toggleSetup(bot)">
      <ion-icon slot="icon-only" name="checkmark-circle"></ion-icon>
    </ion-button>
    <ion-button *ngIf="bot.setupHidden" (click)="botService.toggleSetup(bot)">
      <ion-icon slot="icon-only" name="radio-button-off"></ion-icon>
    </ion-button>
    <ion-button (click)="botService.removeBot(bot)">
      <ion-icon slot="icon-only" name="trash"></ion-icon>
    </ion-button>
  </ion-buttons>
</ion-toolbar>

<ion-list lines="none" class="no-pointer">
  <ion-item *ngIf="!bot.setupHidden">
    <ion-card>
      <ion-card-header>
        <h2>{{ "BotSetup.Setup" | translate }} ({{ bot.setupPosition }})</h2>
      </ion-card-header>
      <ion-card-content>
        <ol>
          <li>
            <a (click)="botService.showPriorities()">{{
              "BotSetup.PriorityMarkers" | translate
            }}</a>
          </li>
          <li
            *ngFor="let rule of bot.setupRules"
            [innerHTML]="
              'SpecificSetup.Cogwheel Corvids.' + rule | translate | format
            "
          ></li>
        </ol>
      </ion-card-content>
    </ion-card>
  </ion-item>

  <ion-item *ngIf="!bot.setupHidden">
    <ion-card>
      <ion-card-header>
        <h2>{{ "BotSetup.Setup" | translate }} ({{ bot.setupPosition }})</h2>
      </ion-card-header>
      <ion-card-content>
        <ion-list>
          <ion-radio-group>
            <ion-item
              *ngFor="
                let diff of ['Easy', 'Normal', 'Challenging', 'Nightmare']
              "
            >
              <ion-radio
                slot="start"
                [value]="diff"
                (click)="botService.changeDifficulty(bot, diff)"
                [checked]="bot.difficulty === diff"
              ></ion-radio>

              <ion-label class="ion-text-wrap">
                <h2>{{ "BotSetup.Difficulty." + diff | translate }}</h2>
                <p
                  [innerHTML]="
                    'SpecificDifficulty.Cogwheel Corvids.' + diff
                      | translate
                      | format
                  "
                ></p>
              </ion-label>
            </ion-item>
          </ion-radio-group>
        </ion-list>
      </ion-card-content>
    </ion-card>
  </ion-item>

  <ion-item *ngIf="!bot.setupHidden">
    <ion-card>
      <ion-card-header>
        <h2>{{ "BotSetup.ChooseTraits" | translate }}</h2>
      </ion-card-header>
      <ion-card-content>
        <ion-list>
          <ion-item *ngFor="let rule of bot.rules">
            <ion-checkbox
              slot="start"
              [disabled]="!rule.canToggle"
              (click)="botService.toggleRule(rule)"
              [checked]="rule.isActive"
            ></ion-checkbox>

            <ion-label class="ion-text-wrap">
              <h2>{{ "SpecificRules." + rule.name | translate }}</h2>
              <p
                [innerHTML]="'SpecificRules.' + rule.text | translate | format"
              ></p>
            </ion-label>
          </ion-item>
        </ion-list>
      </ion-card-content>
    </ion-card>
  </ion-item>

  <ion-item *ngIf="bot.setupHidden">
    <ion-card>
      <ion-card-header>
        <h2>{{ "Sections.DifficultyTraits" | translate }}</h2>
      </ion-card-header>
      <ion-card-content>
        <ion-list>
          <ion-item *ngIf="bot.difficulty !== 'Normal'">
            <ion-label class="ion-text-wrap">
              <h2>
                {{ "BotSetup.DifficultyText" | translate }}:
                {{ bot.difficulty }}
              </h2>
              <p
                [innerHTML]="
                  'SpecificDifficulty.Cogwheel Corvids.' + bot.difficulty
                    | translate
                    | format
                "
              ></p>
            </ion-label>
          </ion-item>
          <ion-item
            *ngFor="let rule of bot.rules"
            [class.ion-hide]="rule.canToggle && !rule.isActive"
          >
            <ion-label class="ion-text-wrap">
              <h2>{{ "SpecificRules." + rule.name | translate }}</h2>
              <p
                [innerHTML]="'SpecificRules.' + rule.text | translate | format"
              ></p>
            </ion-label>
          </ion-item>
        </ion-list>
      </ion-card-content>
    </ion-card>
  </ion-item>

  <ion-item *ngIf="bot.setupHidden">
    <app-bot-resources [bot]="bot"></app-bot-resources>
  </ion-item>

  <ion-item *ngIf="bot.setupHidden">
    <ion-card>
      <ion-card-header>
        <h2>Plots</h2>
      </ion-card-header>
      <div class="plot-storage">
        <div class="plot-cell">
          <img
            src="assets/inicon/plot-back.png"
            class="plot-toggle click-icon plot-icon"
            *ngFor="let plot of [0, 1, 2, 3, 4, 5, 6, 7]"
            [class.in-supply]="bot.customData.stowedPlots < plot"
          />
              <div class="row-additions">
                <ion-button
                  [disabled]="bot.customData.stowedPlots <= -1"
                  (click)="modifyPlot(-1, $event)"
                >
                  <ion-icon name="remove"></ion-icon>
                </ion-button>
                <ion-button 
                  [disabled]="bot.customData.stowedPlots >= 7"
                  (click)="modifyPlot(1, $event)">
                  <ion-icon name="add"></ion-icon>
                </ion-button>
              </div>
        </div>
      </div>
      <ion-card-content>
        <div class="plot-grid">
          <div class="plot-cell" *ngFor="let plot of plots">
            <img
              class="plot-toggle click-icon plot-icon"
              *ngFor="let token of [0, 1]"
              [src]="'assets/inicon/plot-' + plot.type + '.png'"
              [class.in-supply]="bot.customData.plots[plot.type][token] === false"
              (click)="cyclePlot(plot.type, token)"
            />
          </div>
        </div>
      </ion-card-content>
    </ion-card>
  </ion-item>

  <ion-item *ngIf="bot.setupHidden">
    <ion-card>
      <ion-card-header>
        <h2 class="birdsong-has-buttons">
          {{ "Sections.Birdsong" | translate }}
          <ion-button
            class="ion-margin-start"
            (click)="changeSuit(suit)"
            [class.transparent]="bot.customData.currentSuit !== suit"
            *ngFor="let suit of ['bird', 'fox', 'bunny', 'mouse']"
          >
            <img
              class="click-icon"
              slot="icon-only"
              [src]="'assets/inicon/card-' + suit + '.png'"
            />
          </ion-button>
        </h2>
      </ion-card-header>
      <ion-card-content>
        <ol>
          <li
            class="rule-message"
            *ngFor="let message of bot.birdsong(translateService)"
          >
            <para [bot]="bot" [metadata]="message"></para>
          </li>
        </ol>
      </ion-card-content>
    </ion-card>
  </ion-item>

  <ion-item *ngIf="bot.setupHidden">
    <ion-card>
      <ion-card-header>
        <h2>{{ "Sections.Daylight" | translate }}</h2>
      </ion-card-header>
      <ion-card-content>
        <ol>
          <li
            class="rule-message"
            *ngFor="let message of bot.daylight(translateService)"
          >
            <para [bot]="bot" [metadata]="message"></para>
          </li>
        </ol>
      </ion-card-content>
    </ion-card>
  </ion-item>

  <ion-item *ngIf="bot.setupHidden">
    <ion-card>
      <ion-card-header>
        <h2>{{ "Sections.Evening" | translate }}</h2>
      </ion-card-header>
      <ion-card-content>
        <ol>
          <li
            class="rule-message"
            *ngFor="let message of bot.evening(translateService)"
          >
            <para [bot]="bot" [metadata]="message"></para>
          </li>
        </ol>
      </ion-card-content>
    </ion-card>
  </ion-item>
</ion-list>

  <ion-item *ngIf="bot.setupHidden">
    <ion-card>
      <ion-card-header>
        <h2 class="birdsong-has-buttons">
          {{ "Sections.BotRules" | translate }}
        </h2>
      </ion-card-header>
      <ion-card-content>
        <h4>{{"SpecificExtra.Cogwheel Corvids.BotInteractions.Overview" | translate }}</h4>
        <ol>
          <li
            class="rule-message"
            *ngFor="let message of bot.botRules(translateService)"
          >
            <para [bot]="bot" [metadata]="message"></para>
          </li>
        </ol>
        <h4>{{"SpecificExtra.Cogwheel Corvids.Plot-Tokens.Overview" | translate }}
        </h4>
                <ol>
          <li
            class="rule-message"
            *ngFor="let message of bot.plotRules(translateService)"
          >
            <para [bot]="bot" [metadata]="message"></para>
          </li>
        </ol>
      </ion-card-content>
    </ion-card>
  </ion-item>